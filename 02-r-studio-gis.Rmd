# (PART) Maps in R Studio {-}

# Building Static Maps in R Studio

## Load your libraries and set your working directory

```{r}
# Load libraries
library(tmap)
library(sf)
library(tidyverse)
```

If you don't already have the packages installed, you must install them before loading the libraries; you can install the libraries with the following:

```{r, eval=FALSE}
install.packages(c("tmap", "sf", "tidyverse"))
```

After your libraries are successfully installed and loaded, set your working directory by passing the file path of the directory that contains your data to the ```setwd``` function, as in the example below (but note your file path will look different). 

```{r, eval=F}
# Set your working directory to the directory containing your data
setwd("/Users/adra7980/Documents/git_repositories/gistools_qda/data")
```

If you don't know the relevant file path, you can set your working directory manually by opening the ```Session``` menu, scrolling down to 

## Read in a spatial dataset

```{r, echo=-1}
setwd("/Users/adra7980/Documents/git_repositories/gistools_qda/data")
# Read in the shapefile named "usa_shapefile.shp"
usa_shapefile<-st_read("usa_shapefile.shp")
```

## View the spatial dataset's attribute table

```{r}
usa_shapefile
```

## Map the spatial dataset 

```{r, fig.asp=0.5}
tm_shape(usa_shapefile)+
  tm_polygons()
```

```{r}
usa_map<-tm_shape(usa_shapefile)+
            tm_polygons()
```


```{r, fig.asp=0.5}
usa_map
```

## Read in a tabular dataset with the information to map

```{r, echo=-1}
setwd("/Users/adra7980/Documents/git_repositories/gistools_qda/data")
usa_trifecta_data<-read_csv("usa_trifecta.csv")
```

```{r}
usa_trifecta_data
```

## Load Tabular data

```{r, echo=-1}
setwd("/Users/adra7980/Documents/git_repositories/gistools_qda/data")
usa_trifecta<-read_csv("usa_trifecta.csv")
```

```{r}
usa_trifecta
```

## Merge data

```{r}
usa_shapefile_trifecta<-right_join(usa_shapefile, usa_trifecta, by="abbrev" )
```

```{r}
usa_shapefile_trifecta
```

## Map the trifecta data

Start with a rough map:

```{r, fig.asp=0.5}
usa_trifecta_map<-tm_shape(usa_shapefile_trifecta)+
                    tm_polygons(col="Composition")

usa_trifecta_map
```

Adjust the color scheme, such that it is red for a Republican trifecta, dark blue for a democratic trifecta, and 

```{r}
# Sets composition variable as factor
usa_shapefile_trifecta<-usa_shapefile_trifecta %>% 
                          mutate(Composition=factor(Composition, levels=c("Democratic Trifecta", "Republican Trifecta", "Divided Government")))
```

```{r, fig.asp=0.5}
# Maps data with custom colors; note the changed order in the legend
colors<-c("navy", "red3", "seashell")
usa_trifecta_map<-tm_shape(usa_shapefile_trifecta)+
                    tm_polygons(col="Composition", 
                                palette=colors)

usa_trifecta_map
```

Now, let's shift the legend, remove the legend title, and add a title for the map:

```{r, fig.asp=0.5}
usa_trifecta_map<-usa_trifecta_map<-tm_shape(usa_shapefile_trifecta)+
                                      tm_polygons(col="Composition", 
                                                  palette=colors,
                                                  title="")+
                                    tm_layout(legend.position = c("left", "center"),
                                              frame=FALSE,
                                              main.title="Partisan Composition of State Governments, 2022",
                                              main.title.size=1,
                                              main.title.position="center")
                    

usa_trifecta_map
```


# Building Web Maps in R Studio


```{r}
tmap_mode("view")
```

```{r}
usa_trifecta_map
```


```{r}
tmap_mode("plot")
```

```{r}
usa_trifecta_map
```

Make a webmap that shifts Alaska and Hawaii back to their actual locations:

```{r, echo=-1}
setwd("/Users/adra7980/Documents/git_repositories/gistools_qda/data")
usa_unshifted<-st_read("usa_unshifted.shp")
```

```{r}
usa_unshifted
```


```{r}
# join tabular data to "usa_unshifted"
usa_unshifted_trifecta<-inner_join(usa_unshifted, usa_trifecta_data, by="abbrev")

# sets factor
usa_unshifted_trifecta<-usa_unshifted_trifecta %>% 
                          mutate(Composition=factor(Composition, levels=c("Democratic Trifecta", 
                                                  "Republican Trifecta", "Divided Government"))) %>% 
                          rename(State=NAME.x) %>% 
                          relocate(State, Composition)



# recreate map
usa_trifecta_map_unshifed<-tm_shape(usa_unshifted_trifecta)+
                                tm_polygons(col="Composition", 
                                            palette=colors,
                                            title="")+
                                tm_layout(frame=FALSE,
                                          main.title="Partisan Composition of State Governments, 2022",
                                          main.title.size=1,
                                          main.title.position="center")

# change to view mode
tmap_mode("view")

usa_trifecta_map_unshifed
```

# Exporting Maps from R Studio























